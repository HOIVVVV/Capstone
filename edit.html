<!DOCTYPE html>
<html>
<head>
    <title>손상 통계 시각화</title>
    <script>
        function onChartTypeChange() {
            const chartType = document.querySelector("select[name='chart_type']").value;
            const aggregateUnitDiv = document.getElementById("aggregate-unit-div");

            if (chartType === 'line') {
                aggregateUnitDiv.style.display = 'block';
            } else {
                aggregateUnitDiv.style.display = 'none';
            }
        }

        window.onload = onChartTypeChange;
    </script>
</head>
<body>
    <h1>손상 통계 시각화</h1>
    <form method="POST" action="/generate_chart">
        <!-- 날짜 범위 선택 -->
        <label>시작 날짜:</label>
        <input type="date" name="start_date" value="{{ start_date or min_date }}" required>

        <label>종료 날짜:</label>
        <input type="date" name="end_date" value="{{ end_date or max_date }}" required>
        <br><br>

        <!-- 그래프 종류 선택 -->
        <label>그래프 종류 선택:</label>
        <select name="chart_type" onchange="onChartTypeChange()">
            <option value="bar" {% if chart_type == 'bar' %}selected{% endif %}>Bar 그래프</option>
            <option value="pie" {% if chart_type == 'pie' %}selected{% endif %}>Pie 차트</option>
            <option value="line" {% if chart_type == 'line' %}selected{% endif %}>Line 차트</option>
            <option value="heatmap" {% if chart_type == 'heatmap' %}selected{% endif %}>Heatmap 차트</option>
            <option value="stacked" {% if chart_type == 'stacked' %}selected{% endif %}>Stacked 차트</option>
            <option value="map" {% if chart_type == 'map' %}selected{% endif %}>Map 차트</option>
        </select>
        <input type="submit" value="그래프 생성">
        <br><br>

        <!-- 그래프 출력 영역 -->
        <div id="chart-result" style="width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; overflow: auto;">
            {% if chart_html %}
                {{ chart_html|safe }}
            {% else %}
                <p style="text-align: center; line-height: 600px; color: #999;">그래프가 여기에 표시됩니다.</p>
            {% endif %}
        </div>

        <!-- Line 차트 집계 단위 옵션 (line 차트 선택 시만 표시) -->
        <div id="aggregate-unit-div" style="margin-top: 20px; display: none;">
            <label>집계 단위:</label>
            <select name="aggregate_unit">
                <option value="month" {% if aggregate_unit == 'month' %}selected{% endif %}>월별</option>
                <option value="quarter" {% if aggregate_unit == 'quarter' %}selected{% endif %}>분기별</option>
            </select>
            <br><br>
        </div>

        <!-- 손상 유형 필터 -->
        <div id="damage-filter" style="width: 150px; height: 500px; border: 1px solid #ccc; overflow: auto; padding: 10px; float: left; margin-right: 20px;">
            <label><strong>손상 유형</strong></label><br>
            {% for dtype in damage_types %}
                <div>
                    <input type="checkbox" class="damage-type-checkbox" name="damage_type" value="{{ dtype }}"
                    {% if dtype in selected_damage_types %}checked{% endif %}> {{ dtype }}
                </div>
            {% endfor %}
        </div>

        <!-- 촬영 위치 필터 -->
        <div id="location-filter" style="width: 150px; height: 500px; border: 1px solid #ccc; overflow: auto; padding: 10px; float: left;">
            <label><strong>촬영 위치</strong></label><br>
            {% for loc in locations %}
                <div>
                    <input type="checkbox" name="location" value="{{ loc }}"
                    {% if loc in selected_locations %}checked{% endif %}> {{ loc }}
                </div>
            {% endfor %}
        </div>

        <div style="clear: both;"></div>
    </form>
</body>
</html>
