<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}í•˜ìˆ˜ê´€ë¡œ ê´€ë¦¬ ì‹œìŠ¤í…œ{% endblock %}</title>
  <style>
    body { margin: 0; font-family: 'Noto Sans KR', sans-serif; background: #f9f9f9; }
    .layout { display: flex; height: 100vh; }

    .sidebar {
      width: 220px;
      background: linear-gradient(to bottom, #d32f2f, #b71c1c);
      color: white;
      padding: 20px;
    }
    .sidebar h2 { margin-top: 0; font-size: 18px; }
    .sidebar ul { list-style: none; padding: 0; margin-top: 40px; }
    .sidebar li { padding: 10px 0; cursor: pointer; }
    .sidebar li:hover, .sidebar .active { font-weight: bold; color: #ffd700; }

    .main { flex: 1; display: flex; flex-direction: column; }

    .topbar {
      height: 60px;
      background: #fff;
      border-bottom: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
    }

    .footer {
      height: 40px;
      background: #fff;
      border-top: 1px solid #ddd;
      text-align: center;
      padding: 10px;
      font-size: 13px;
      color: #777;
    }

    .content {
      flex: 1;
      padding: 20px;
      background: #f9f9f9;
      overflow-y: auto;
    }

    /* âœ… íŒì—… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 20px;
      max-width: 80%;
      max-height: 80%;
      overflow-y: auto;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 10px; right: 15px;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>í•˜ìˆ˜ê´€ë¡œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
      <ul>
        <li {% if active_page == 'dashboard' %}class="active"{% endif %}>
          <a href="/" style="color: inherit; text-decoration: none;">ëŒ€ì‹œë³´ë“œ</a>
        </li>
        <li {% if active_page == 'result' %}class="active"{% endif %}>
          <a href="/result" style="color: inherit; text-decoration: none;">ê´€ë¡œ ì ê²€ ê²°ê³¼</a>
        </li>
        <li {% if active_page == 'stats' %}class="active"{% endif %}>
          <a href="/stats" style="color: inherit; text-decoration: none;">ì†ìƒ í†µê³„</a>
        </li>
        <li {% if active_page == 'mapping' %}class="active"{% endif %}>
          <a href="/mapping" style="color: inherit; text-decoration: none;">ì†ìƒë„ ë§¤í•‘</a>
        </li>
        <li {% if active_page == 'upload' %}class="active"{% endif %}>
          <a href="/upload" style="color: inherit; text-decoration: none;">í•˜ìˆ˜ê´€ë¡œ ì†ìƒ ë¶„ì„</a>
        </li>
      </ul>
    </div>

    <!-- Main -->
    <div class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div style="display: flex; gap: 40px; font-size: 15px;">
          <div>
            ğŸ“Š <strong>ì†ìƒ ì´ë¯¸ì§€</strong>: <span id="damage-count">-</span>ê±´
          </div>
          <div>
            ğŸ¬ <strong>ë¶„ì„ ì˜ìƒ</strong>: <span id="video-count">-</span>ê±´
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <button onclick="location.href='/info'"
            style="padding: 5px 10px; line-height: 1.5; background: #d32f2f; color: white; border: none; border-radius: 4px; cursor: pointer;">
            ğŸ§¾ ì‹œìŠ¤í…œ ì†Œê°œ
          </button>

          <button onclick="openImageModal()"
                  style="padding: 5px 10px; line-height: 1.5; background: #d32f2f; color: white; border: none; border-radius: 4px; cursor: pointer;">
            ğŸ–¼ï¸ ìµœê·¼ ì´ë¯¸ì§€ ë³´ê¸°
          </button>
        </div>
      </div>

      <!-- Content block -->
      <div class="content">
        {% block content %}{% endblock %}
      </div>

      <!-- Footer -->
      <div class="footer">
        Â© 2025 <a href="http://sejong.ac.kr" target="_blank">Sejong University</a> Capstone Team 6
      </div>
    </div>
  </div>

  <!-- âœ… ì´ë¯¸ì§€ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="imageModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <h3 style="margin-top: 0;">ğŸ“¸ ìµœê·¼ ì´ë¯¸ì§€</h3>
      <div id="imageList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;"></div>
    </div>
  </div>


  <!-- âœ… JavaScript -->
  <script>
    // ì†ìƒ ì´ë¯¸ì§€ ë° ì˜ìƒ ê°œìˆ˜ ë¡œë“œ
    window.addEventListener('DOMContentLoaded', () => {
      fetch('/api/count_summary')
        .then(res => res.json())
        .then(data => {
          document.getElementById('damage-count').textContent = data.damage_images;
          document.getElementById('video-count').textContent = data.videos;
        })
        .catch(err => {
          console.error("ğŸ“› ê°œìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:", err);
        });
    });

    // ì´ë¯¸ì§€ íŒì—… ì—´ê¸°
    function openImageModal() {
      fetch('/api/recent_images')
        .then(res => res.json())
        .then(data => {
          const imageList = document.getElementById('imageList');
          imageList.innerHTML = '';
          data.images.forEach(path => {
            const img = document.createElement('img');
            img.src = path;
            img.style.width = '100%';
            img.style.border = '1px solid #ccc';
            imageList.appendChild(img);
          });
          document.getElementById('imageModal').style.display = 'flex';
        })
        .catch(err => console.error("âŒ ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err));
    }

    // ì´ë¯¸ì§€ íŒì—… ë‹«ê¸°
    function closeModal() {
      document.getElementById('imageModal').style.display = 'none';
    }
  </script>
</body>
</html>
