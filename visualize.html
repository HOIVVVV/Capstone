<!DOCTYPE html>
<html>
<head>
    <title>손상 통계 시각화</title>
    <script>
        function onChartTypeChange() {
            const chartType = document.querySelector("select[name='chart_type']").value;
            const defaultFilters = document.getElementById("default-filters");
            const lineOptionSelector = document.getElementById("line-option-selector");
            const mapOptionSelector = document.getElementById("map-option-selector");
            const mapContainer = document.getElementById("map-container");


            if (chartType === 'line') {
                defaultFilters.style.display = 'none';
                lineOptionSelector.style.display = 'block';
                mapOptionSelector.style.display = 'none';
                mapContainer.style.display = 'none';
            } else if (chartType === 'map') {
                defaultFilters.style.display = 'none';
                lineOptionSelector.style.display = 'none';
                mapOptionSelector.style.display = 'block';
                mapContainer.style.display = 'block';
            } else {
                defaultFilters.style.display = 'block';
                lineOptionSelector.style.display = 'none';
                mapOptionSelector.style.display = 'none';
                mapContainer.style.display = 'none';
            }
        }

        window.onload = onChartTypeChange;
    </script>
</head>
<body>
    <h1>손상 통계 시각화</h1>
    <form method="POST" action="/generate_chart">

        <!-- ✅ 날짜 범위 선택 -->
        <label>시작 날짜:</label>
        <input type="date" name="start_date" value="{{ min_date }}" required>
        <label>종료 날짜:</label>
        <input type="date" name="end_date" value="{{ max_date }}" required><br><br>
        

        <!-- ✅ 그래프 종류 선택 -->
        <label>그래프 종류 선택:</label>
        <select name="chart_type" onchange="onChartTypeChange()">
            <option value="bar">Bar 그래프</option>
            <option value="pie">Pie 차트</option>
            <option value="line">Line 차트</option>
            <option value="heatmap">Heatmap 차트</option>
            <option value="stacked">Stacked 차트</option>
            <option value="map">Map 차트</option>
        </select>
        <input type="submit" value="그래프 생성"><br><br>

        <!-- ✅ 그래프 출력 영역 (고정 높이) -->
        <div id="chart-result" style="width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; overflow: auto;">
            {% if chart_html %}
                {{ chart_html|safe }}
            {% else %}
                <p style="text-align: center; line-height: 600px; color: #999;">그래프가 여기에 표시됩니다.</p>
            {% endif %}
        </div>

        <!-- ✅ line 차트 전용 옵션 -->
        <div id="line-option-selector" style="display:none;">
            <label>집계 단위:</label>
            <select name="aggregate_unit">
                <option value="month">월별</option>
                <option value="quarter">분기별</option>
            </select><br><br>


            <label>손상 유형</label><br>
            {% for dtype in damage_types %}
                <input type="checkbox" name="damage_type" value="{{ dtype }}">{{ dtype }}<br>
            {% endfor %}

            <label>촬영 위치</label><br>
            {% for loc in locations %}
                <input type="checkbox" name="location" value="{{ loc }}">{{ loc }}<br>
            {% endfor %}
        </div>

        <!-- ✅ map 차트 전용 옵션 -->
        <div id="map-option-selector" style="display:none;">
            <label>손상 유형</label><br>
            {% for dtype in damage_types %}
                <input type="checkbox" name="damage_type" value="{{ dtype }}">{{ dtype }}<br>
            {% endfor %}

            <label>촬영 위치</label><br>
            {% for loc in locations %}
                <input type="checkbox" name="location" value="{{ loc }}">{{ loc }}<br>
            {% endfor %}
        </div>

        <!-- ✅ 기본 필터 (bar, pie, heatmap, stacked용) -->
        <div id="default-filters">
            <label>손상 유형</label><br>
            {% for dtype in damage_types %}
                <input type="checkbox" name="damage_type" value="{{ dtype }}">{{ dtype }}<br>
            {% endfor %}

            <label>촬영 위치</label><br>
            {% for loc in locations %}
                <input type="checkbox" name="location" value="{{ loc }}">{{ loc }}<br>
            {% endfor %}
        </div>


            <!-- ✅ 지도 시각화 영역 -->
    <div id="map-container" style="display: none;">
        <h2>지도 시각화</h2>
        {{ map_html|safe }}
    </div>
    </form>
</body>
</html>
