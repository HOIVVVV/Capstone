<!DOCTYPE html>
<html>
<head>
    <title>손상 통계 시각화</title>
    <script>
        function onChartTypeChange() {
            const chartType = document.querySelector("select[name='chart_type']").value;
            const defaultFilters = document.getElementById("default-filters");
            const lineOptionSelector = document.getElementById("line-option-selector");


            if (chartType === 'line') {
                defaultFilters.style.display = 'none';
                lineOptionSelector.style.display = 'flex';
            } else {
                defaultFilters.style.display = 'flex';
                lineOptionSelector.style.display = 'none';
            }
        }

        window.onload = onChartTypeChange;
    </script>
</head>
<body>
    <h1>손상 통계 시각화</h1>
    <form method="POST" action="/generate_chart">

        <!-- ✅ 날짜 범위 선택 -->
        <label>시작 날짜:</label>
        <input type="date" name="start_date" value="{{ min_date }}" required>
        <label>종료 날짜:</label>
        <input type="date" name="end_date" value="{{ max_date }}" required><br><br>
        

        <!-- ✅ 그래프 종류 선택 -->
        <label>그래프 종류 선택:</label>
        <select name="chart_type" onchange="onChartTypeChange()">
            <option value="bar">Bar 그래프</option>
            <option value="pie">Pie 차트</option>
            <option value="line">Line 차트</option>
            <option value="heatmap">Heatmap 차트</option>
            <option value="stacked">Stacked 차트</option>
            <option value="map">Map 차트</option>
        </select>
        <input type="submit" value="그래프 생성"><br><br>

        <!-- ✅ 그래프 출력 영역 (고정 높이) -->
        <div id="chart-result" style="width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; overflow: auto;">
            {% if chart_html %}
                {{ chart_html|safe }}
            {% else %}
                <p style="text-align: center; line-height: 600px; color: #999;">그래프가 여기에 표시됩니다.</p>
            {% endif %}
        </div>



        <!-- ✅ 필터 전체를 감싸는 부모 컨테이너 -->
        <div id = "line-option-selector" style="gap: 20px; margin-top: 20px;">
            <label>집계 단위:</label>
            <select name="aggregate_unit">
                <option value="month">월별</option>
                <option value="quarter">분기별</option>
            </select><br><br>
            <!-- 손상 유형 필터 -->
            <div id="damage-filter" style="width: 150px; height: 500px; border: 1px solid #ccc; overflow: auto; padding: 10px;">
                <label><strong>손상 유형</strong></label><br>

                <!-- ✅ 개별 손상 유형 체크박스 -->
                {% for dtype in damage_types %}
                    <div>
                        <input type="checkbox" class="damage-type-checkbox" name="damage_type" value="{{ dtype }}"> {{ dtype }}
                    </div>
                {% endfor %}
            </div>

            <!-- 촬영 위치 필터 -->
            <div id="location-filter" style="width: 150px; height: 500px; border: 1px solid #ccc; overflow: auto; padding: 10px;">
                <label><strong>촬영 위치</strong></label><br>
                {% for loc in locations %}
                    <div>
                        <input type="checkbox" name="location" value="{{ loc }}"> {{ loc }}
                    </div>
                {% endfor %}
            </div>
        </div>
        <!-- ✅ 필터 전체를 감싸는 부모 컨테이너 -->
        <div id = "default-filters" style="gap: 20px; margin-top: 20px;">
            <!-- 손상 유형 필터 -->
            <div id="damage-filter" style="width: 150px; height: 500px; border: 1px solid #ccc; overflow: auto; padding: 10px;">
                <label><strong>손상 유형</strong></label><br>

                <!-- ✅ 개별 손상 유형 체크박스 -->
                {% for dtype in damage_types %}
                    <div>
                        <input type="checkbox" class="damage-type-checkbox" name="damage_type" value="{{ dtype }}"> {{ dtype }}
                    </div>
                {% endfor %}
            </div>

            <!-- 촬영 위치 필터 -->
            <div id="location-filter" style="width: 150px; height: 500px; border: 1px solid #ccc; overflow: auto; padding: 10px;">
                <label><strong>촬영 위치</strong></label><br>
                {% for loc in locations %}
                    <div>
                        <input type="checkbox" name="location" value="{{ loc }}"> {{ loc }}
                    </div>
                {% endfor %}
            </div>
        </div>
    </form>
</body>
</html>
